{% extends "tartan_eats/base.html" %}
{% block scripts %}
{% load static %}
<script src="https://www.paypal.com/sdk/js?client-id=AVWSCG_C5SB_--rHaWd5FKF8YKx_xY2yTlkrdK0tRyH-QcYZoDvof1Nfs1JjAgp_9ooAYsGM9YMCmJd4&currency=USD&disable-funding=credit,card"></script>
<script src="{% static 'tartan_eats/paypal.js'%}" type="text/javascript"></script>

{% endblock %}

{% block navbar %}
<li>
  <a href="{% url 'customer-home' %}">Home</a>
</li>
<!-- / Home -->
<!-- My Orders -->
<li>
  <a href="{% url 'customer-history-order' %}">My Orders</a>
</li>
<!-- / My Orders -->
<!-- My Account -->
<li>
  <a href="{% url 'customer-account' %}">My Account</a>
</li>
{% endblock %}

{% block pagename %}
<section class="page-header">
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div class="content">
        <h1 class="page-name">Check Out</h1>
      </div>
    </div>
  </div>
</div>
</section>
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="checkout shopping">
       <div class="container">
          <div class="row">
             <div class="col-md-8">
                <div class="block billing-details">
                   <h4 class="widget-title">Order Details</h4>

                   <form id="contact-form" method="post" action="{% url 'customer-checkout' order_cuisines.first.order.id %}" >
                     <table>
                       {% for field in form.visible_fields %}
                           <tr>
                               <td>{{field.label_tag}}</td>
                               <td>{{field}}</td>
                               <td class="error">
                                   {% for error in field.errors %} {{error}} {% endfor %}
                               </td>
                           </tr>
                       {% endfor %}
                   </table>
                 {% csrf_token %}
                 <!-- submit button -->
               <div class="cutsomer-page-op-btm">
                  <button type="submit">Save Change</button>
               </div>
            </form>
               </div>
               <div class="block">
                  <h4 class="widget-title">Payment Method</h4>
                  <p>Now only Paypal supported</p>
                  <div id="paypal-payment-button">
                 </div>
                  <div class="checkout-product-details">
                     <div class="payment">
                        <div class="card-details">
                           <form class="checkout-form">

                              <a href="{% url 'cancel-order' order_cuisines.first.order.id %}" class="btn btn-main mt-20">Cancel Order</a>
                             </form>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
             <!-- detail product list at right  -->
             <div class="col-md-4">
                <div class="product-checkout-details">
                   <div class="block">
                      <h4 class="widget-title">Order Summary</h4>
                      <!-- shopping cart item  -->
                      {% for item in order_cuisines %}
                      <div class="media product-card">
                           <div class="media-body">
                              <h4 class="media-heading"><a href="product-single.html">{{item.cuisine.cuisine_name}}</a></h4>
                              <p class="price"> ${{item.cuisine.price}} x {{item.item_quantity}} </p>
                           </div>
                      </div>
                      {% endfor %}
                      <!-- /shopping cart item  -->
                      <ul class="summary-prices">
                         <li>
                            <span>Subtotal:</span>
                            <span>${{order_cuisines.first.order.subtotal}}</span>
                         </li>
                         <li>
                            <span>Tax:</span>
                            <span>${{order_cuisines.first.order.tax}}</span>
                         </li>
                         <li>
                            <span>Delivery Fee:</span>
                            <span>${{order_cuisines.first.order.restaurant.delivery_fee}}</span>
                         </li>
                      </ul>
                      <div class="summary-total">
                         <span>Total</span>
                         <span>${{order_cuisines.first.order.total_amount}}</span>
                      </div>
                   </div>
                </div>
             </div>
             <!-- / detail product list at right  -->
          </div>
       </div>
    </div>
 </div>

<script>
   var total_price = "{{order_cuisines.first.order.total_amount}}"
//let confirmation_url = "{% url 'confirmation' 0 %}".replace("0", id)
   var id = "{{order_cuisines.first.order.id}}"
   var confirmation_url = function(id) {
      return "{% url 'confirmation' 0 %}".replace("0",id)
   }

   var cancel_url = function(id) {
      return "{% url 'oncancel' 0 %}".replace("0",id)
   }
</script>

{% endblock %}